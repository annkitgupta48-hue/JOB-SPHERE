<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Signup - Job Sphere</title>
  <link rel="stylesheet" href="../style.css">

  <style>
    /* Elevated, nature-inspired background */
    body { background: linear-gradient(180deg,#e8f5e9 0%, #f1f8e9 50%, #e3f2fd 100%); font-family: 'Poppins',sans-serif; }
    main.container { max-width:760px; margin:36px auto; padding:20px; }

    .signup-wrap { display:flex; gap:24px; align-items:flex-start; }
    .card.form-card { flex:1; padding:22px; border-radius:14px; box-shadow: 0 10px 30px rgba(34,50,80,0.08); background: rgba(255,255,255,0.9); }

    h2 { margin:0 0 12px; font-size:1.5rem; color:#143; }

    .input { width:100%; padding:12px 14px; border-radius:10px; border:1px solid rgba(20,40,30,0.08); margin-top:10px; transition: all .18s ease; }
    .input:focus { outline:none; box-shadow: 0 6px 18px rgba(20,60,40,0.06); transform: translateY(-2px); border-color: rgba(34,139,34,0.3); }

    .btn { background: linear-gradient(90deg,#2e7d32,#66bb6a); color:white; border:none; padding:10px 14px; border-radius:9px; cursor:pointer; transition: transform .15s ease, box-shadow .15s ease; }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(40,120,40,0.12); }

    .social-btn { display:flex; gap:8px; align-items:center; padding:10px; border-radius:10px; background:white; border:1px solid rgba(0,0,0,0.06); cursor:pointer; }
    .social-btn:hover { transform: translateY(-4px); box-shadow: 0 12px 30px rgba(0,0,0,0.06); }

    /* visual nature accents (floating leaves) */
    .nature-decor { position:fixed; right:-60px; top:10%; width:220px; height:220px; pointer-events:none; opacity:0.9; }
    .leaf { width:100%; height:100%; animation: floaty 8s ease-in-out infinite; }
    .leaf:nth-child(2){ transform: scale(.7) rotate(25deg); right:10px; animation-duration:10s; opacity:0.7 }
    @keyframes floaty { 0%{transform:translateY(0) rotate(0)}50%{transform:translateY(-18px) rotate(6deg)}100%{transform:translateY(0) rotate(0)} }

    .small { color:#4b5; font-size:0.95rem }

    /* Responsive */
    @media (max-width:760px){ .signup-wrap{flex-direction:column} .nature-decor{display:none} }
  </style>

  <!-- Google Identity Services client (load only when using Google Sign-In) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <header class="header"><div class="container wrap"><a class="brand" href="/index.html"><div class="logo">JS</div><div><strong>Job Sphere</strong></div></a></div></header>

  <main class="container">
    <h2>Create Account</h2>
    <div class="signup-wrap">
      <form id="signupForm" class="card form-card">
        <input id="name" class="input" placeholder="Full name" required>
        <input id="email" class="input" placeholder="Email" required>
        <input id="password" type="password" class="input" placeholder="Password" required>

        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn">Signup</button>
          <a href="/pages/login.html" class="small" style="align-self:center">Already have account?</a>
        </div>

        <div style="margin-top:12px; border-top:1px dashed rgba(0,0,0,0.04); padding-top:12px;">
          <div style="margin-bottom:8px; color:#666; font-size:0.95rem">Or sign up using</div>
          <div id="googleSignInBtn" style="display:inline-block"></div>
          <div class="small" style="margin-top:8px">To enable Google Sign-In: create an OAuth Client ID in Google Cloud Console and set `CLIENT_ID` below.</div>
        </div>
      </form>

      <aside style="width:300px">
        <div class="card" style="padding:18px;border-radius:14px; background:linear-gradient(180deg, rgba(255,255,255,0.85), rgba(250,255,240,0.9)); box-shadow:0 10px 30px rgba(20,60,20,0.06)">
          <h3 style="margin-top:0;color:#2b5">Why sign up?</h3>
          <ul style="padding-left:16px;color:#445">
            <li>Save and apply to jobs quickly</li>
            <li>Post jobs (employers)</li>
            <li>Get personalized recommendations</li>
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <svg class="nature-decor" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
    <g class="leaf" fill="#76c893">
      <path d="M20,100 C40,10 160,10 180,100 C160,120 40,120 20,100 Z"/>
    </g>
    <g class="leaf" fill="#a3d39c" transform="translate(20,30)">
      <path d="M10,90 C30,20 140,20 160,90 C140,110 30,110 10,90 Z"/>
    </g>
  </svg>

  <footer class="footer">© Job Sphere</footer>

  <script src="/db.js"></script>
  <script src="../app.js"></script>
  <script>
    // ===== GOOGLE SIGN-IN HANDLER FOR SIGNUP =====
    function handleGoogleCredential(response) {
      if (!response || !response.credential) {
        showNotification('Google sign-up failed', 'error');
        return;
      }

      try {
        const payload = parseJwt(response.credential);
        if (!payload) {
          showNotification('Could not parse Google token', 'error');
          return;
        }

        const email = payload.email;
        const name = payload.name || payload.given_name || '';
        
        if (!email) {
          showNotification('Google account email not available', 'warning');
          return;
        }

        const users = getUsers();
        let user = users.find(u => u.email === email);
        
        if (!user) {
          user = {
            id: 'u' + Date.now(),
            name: name || email.split('@')[0],
            email: email,
            password: '',
            role: 'user',
            provider: 'google',
            createdAt: new Date().toISOString()
          };
          users.push(user);
          saveUsers(users);
        }

        setCurrentUser(user);
        showNotification(`✅ Welcome, ${user.name}! Account created.`, 'success');
        setTimeout(() => location.href = '/pages/user-dashboard.html', 800);
      } catch (error) {
        console.error('Google sign-up error:', error);
        showNotification('Google sign-up error', 'error');
      }
    }

    // ===== JWT PARSER =====
    function parseJwt(token) {
      try {
        const payload = token.split('.')[1];
        const json = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));
        return JSON.parse(decodeURIComponent(escape(json)));
      } catch (e) {
        console.error('JWT parse error:', e);
        return null;
      }
    }

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
      // Initialize Google Sign-In
      if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
        const CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com';
        google.accounts.id.initialize({
          client_id: CLIENT_ID,
          callback: handleGoogleCredential
        });

        if (document.getElementById('googleSignInBtn')) {
          google.accounts.id.renderButton(
            document.getElementById('googleSignInBtn'),
            { theme: 'outline', size: 'large', width: 240 }
          );
        }
      }

      console.log('✅ Signup page ready with Google Sign-In');
    });
  </script>
</body>
</html>
