<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Login - Job Sphere</title>
  <link rel="stylesheet" href="../style.css">

  <style>
    /* Elevated, nature-inspired background */
    body { background: linear-gradient(180deg, #e8f5e9 0%, #f1f8e9 50%, #e3f2fd 100%); font-family: 'Poppins', sans-serif; min-height: 100vh; display: flex; flex-direction: column; }
    main.container { flex: 1; max-width: 720px; margin: 36px auto; padding: 20px; }

    .login-wrap { display: flex; gap: 24px; align-items: flex-start; }
    .card.form-card { flex: 1; padding: 22px; border-radius: 14px; box-shadow: 0 10px 30px rgba(34, 50, 80, 0.08); background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); }

    h2 { margin: 0 0 12px; font-size: 1.5rem; color: #143; }
    .subtitle { color: #666; font-size: 0.95rem; margin-bottom: 16px; }

    .input { width: 100%; padding: 12px 14px; border-radius: 10px; border: 1px solid rgba(20, 40, 30, 0.08); margin-top: 10px; transition: all 0.18s ease; font-size: 1rem; box-sizing: border-box; }
    .input:focus { outline: none; box-shadow: 0 6px 18px rgba(20, 60, 40, 0.06); transform: translateY(-2px); border-color: rgba(34, 139, 34, 0.3); }
    .input:hover { border-color: rgba(34, 139, 34, 0.15); }

    .btn { background: linear-gradient(90deg, #2e7d32, #66bb6a); color: white; border: none; padding: 10px 14px; border-radius: 9px; cursor: pointer; transition: transform 0.15s ease, box-shadow 0.15s ease; font-weight: 600; }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 12px 30px rgba(40, 120, 40, 0.12); }
    .btn:active { transform: translateY(-1px); }

    .small { color: #4b5; font-size: 0.95rem; }
    a.small { text-decoration: none; transition: all 0.2s ease; }
    a.small:hover { color: #2e7d32; text-decoration: underline; }

    /* Divider */
    .divider { display: flex; align-items: center; margin: 14px 0; color: #aaa; font-size: 0.9rem; }
    .divider::before, .divider::after { content: ''; flex: 1; height: 1px; background: rgba(0, 0, 0, 0.04); }
    .divider::before { margin-right: 8px; }
    .divider::after { margin-left: 8px; }

    /* Social/Google button */
    #googleSignInBtn { display: inline-block; margin-top: 8px; }

    /* Tab buttons */
    .tab-btn { 
      background: none; 
      border: none; 
      padding: 12px 20px; 
      cursor: pointer; 
      font-weight: 600; 
      color: #666; 
      transition: all 0.2s; 
      border-bottom: 3px solid transparent;
      font-size: 1rem;
    }
    .tab-btn.active { 
      color: #2e7d32; 
      border-bottom-color: #2e7d32; 
    }
    .tab-btn:hover { 
      color: #2e7d32; 
    }

    /* Info panel */
    .info-panel { width: 280px; }
    .info-panel .card { padding: 18px; border-radius: 14px; background: linear-gradient(180deg, rgba(255, 255, 255, 0.85), rgba(250, 255, 240, 0.9)); box-shadow: 0 10px 30px rgba(20, 60, 20, 0.06); }
    .info-panel h3 { margin-top: 0; color: #2b5; font-size: 1.1rem; }
    .info-panel ul { padding-left: 16px; color: #445; margin: 8px 0; }
    .info-panel li { margin: 6px 0; line-height: 1.4; }

    /* Nature decor: animated background elements */
    .nature-decor { position: fixed; right: -60px; top: 10%; width: 220px; height: 220px; pointer-events: none; opacity: 0.9; }
    .leaf { width: 100%; height: 100%; animation: floaty 8s ease-in-out infinite; }
    .leaf:nth-child(2) { transform: scale(0.7) rotate(25deg); right: 10px; animation-duration: 10s; opacity: 0.7; }
    @keyframes floaty { 0% { transform: translateY(0) rotate(0deg); } 50% { transform: translateY(-18px) rotate(6deg); } 100% { transform: translateY(0) rotate(0deg); } }

    /* Responsive */
    @media (max-width: 760px) {
      .login-wrap { flex-direction: column; }
      .info-panel { width: 100%; }
      .nature-decor { display: none; }
    }
  </style>

  <!-- Google Identity Services client -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
</head>

<body>
  <header class="header">
    <div class="container wrap">
      <a class="brand" href="/index.html">
        <div class="logo">JS</div>
        <div><strong>Job Sphere</strong></div>
      </a>
    </div>
  </header>

  <main class="container">
    <!-- Tab Switcher -->
    <div style="display: flex; gap: 16px; margin-bottom: 24px; border-bottom: 2px solid rgba(0,0,0,0.1);">
      <button id="userLoginTab" class="tab-btn active" onclick="switchLoginTab('user')">üë§ User Login</button>
      <button id="adminLoginTab" class="tab-btn" onclick="switchLoginTab('admin')">üîê Admin Login</button>
    </div>

    <!-- User Login Section -->
    <div id="user-login" class="login-section" style="display: block;">
      <h2>Welcome Back</h2>
      <div class="login-wrap">
        <form id="loginForm" class="card form-card">
          <p class="subtitle">Sign in to your account</p>

          <input id="email" class="input" placeholder="Email" required>
          <input id="password" type="password" class="input" placeholder="Password" required>

          <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button class="btn">Login</button>
            <a href="/pages/signup.html" class="small" style="align-self: center;">Create account</a>
          </div>

          <div class="divider">Or</div>

          <div style="margin-top: 12px;">
            <div id="googleSignInBtn" style="display: inline-block;"></div>
            <div class="small" style="margin-top: 8px; color: #888;">To enable Google Sign-In: get OAuth Client ID from Google Cloud Console.</div>
          </div>
        </form>

        <aside class="info-panel">
          <div class="card">
            <h3>Why sign in?</h3>
            <ul>
              <li>‚úì Quick access to saved jobs</li>
              <li>‚úì Manage applications</li>
              <li>‚úì Post jobs (employers)</li>
              <li>‚úì Get personalized feeds</li>
            </ul>

            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(0, 0, 0, 0.04);">
              <p class="small" style="margin: 0; font-style: italic;">Secure, fast, and easy.</p>
            </div>
          </div>
        </aside>
      </div>
    </div>

    <!-- Admin Login Section -->
    <div id="admin-login" class="login-section" style="display: none;">
      <h2>üîê Admin Dashboard Login</h2>
      <div class="login-wrap">
        <form id="adminLoginForm" class="card form-card">
          <p class="subtitle">Admin credentials required</p>

          <div style="background: #fffbf0; border-left: 4px solid #ff9800; padding: 12px; border-radius: 6px; margin-bottom: 14px;">
            <p style="margin: 0; font-size: 0.9rem; color: #e65100;">
              <strong>‚ö†Ô∏è Admin Only:</strong> Manage jobs, categories, and approve submissions.
            </p>
          </div>

          <label style="display: block; color: #333; font-weight: 600; margin-top: 12px;">Admin Email</label>
          <input id="admin_email" class="input" type="email" placeholder="admin@jobspare.com" required>

          <label style="display: block; color: #333; font-weight: 600; margin-top: 12px;">Admin Password</label>
          <input id="admin_password" type="password" class="input" placeholder="Enter admin password" required>

          <div style="display: flex; gap: 8px; margin-top: 16px;">
            <button type="button" class="btn" onclick="adminLogin(event)">üîì Admin Login</button>
            <button type="button" class="btn" style="background: #666; flex: 0;" onclick="switchLoginTab('user')">‚Üê Back</button>
          </div>

          <div style="margin-top: 14px; padding: 12px; background: #f0f7ff; border-radius: 6px; border-left: 4px solid #2196f3;">
            <p style="margin: 0; font-size: 0.85rem; color: #0d47a1;">
              <strong>Default Admin:</strong><br>
              Email: admin@jobspare.com<br>
              Password: admin123
            </p>
          </div>
        </form>

        <aside class="info-panel">
          <div class="card">
            <h3>Admin Features</h3>
            <ul>
              <li>‚úì Post new jobs</li>
              <li>‚úì Manage all jobs</li>
              <li>‚úì Approve submissions</li>
              <li>‚úì Create categories</li>
              <li>‚úì Edit apply links</li>
              <li>‚úì View analytics</li>
            </ul>

            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid rgba(0, 0, 0, 0.04);">
              <p class="small" style="margin: 0; font-style: italic; color: #ff6f00;">
                üîê Secure admin access only.
              </p>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </main>

  <!-- Floating nature decoration -->
  <svg class="nature-decor" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
    <g class="leaf" fill="#76c893">
      <path d="M20,100 C40,10 160,10 180,100 C160,120 40,120 20,100 Z"/>
    </g>
    <g class="leaf" fill="#a3d39c" transform="translate(20,30)">
      <path d="M10,90 C30,20 140,20 160,90 C140,110 30,110 10,90 Z"/>
    </g>
  </svg>

  <footer class="footer">¬© Job Sphere</footer>

  <script src="/db.js"></script>
  <script src="../app.js"></script>
  <script>
    // ===== LOGIN TAB SWITCHING =====
    function switchLoginTab(tab) {
      document.querySelectorAll('.login-section').forEach(s => s.style.display = 'none');
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
      
      if (tab === 'user') {
        document.getElementById('user-login').style.display = 'block';
        document.getElementById('userLoginTab').classList.add('active');
      } else {
        document.getElementById('admin-login').style.display = 'block';
        document.getElementById('adminLoginTab').classList.add('active');
      }
    }

    // ===== USER LOGIN HANDLER =====
    function userLogin(e) {
      e.preventDefault();
      const email = document.getElementById('email').value.trim();
      const password = document.getElementById('password').value.trim();

      if (!email || !password) {
        showNotification('Please enter email and password', 'warning');
        return;
      }

      const users = getUsers();
      const user = users.find(u => u.email === email);

      if (!user || user.password !== password) {
        showNotification('‚ùå Invalid email or password', 'error');
        return;
      }

      setCurrentUser(user);
      showNotification(`‚úÖ Welcome, ${user.name}!`, 'success');
      setTimeout(() => location.href = '/pages/user-dashboard.html', 800);
    }

    // ===== ADMIN LOGIN HANDLER =====
    function adminLogin(e) {
      e.preventDefault();
      const email = document.getElementById('admin_email').value.trim();
      const password = document.getElementById('admin_password').value.trim();

      if (!email || !password) {
        showNotification('Please enter admin credentials', 'warning');
        return;
      }

      const users = getUsers();
      const admin = users.find(u => u.email === email && u.role === 'admin');

      if (!admin || admin.password !== password) {
        showNotification('‚ùå Invalid admin credentials', 'error');
        console.warn('‚ùå Admin login failed - check credentials');
        return;
      }

      setCurrentUser(admin);
      showNotification(`‚úÖ Welcome Admin, ${admin.name}!`, 'success');
      console.log('‚úÖ Admin authenticated:', admin);
      setTimeout(() => location.href = '/pages/admin-dashboard.html', 800);
    }

    // ===== GOOGLE SIGN-IN HANDLER =====
    function handleGoogleCredential(response) {
      if (!response || !response.credential) {
        showNotification('Google sign-in failed', 'error');
        return;
      }

      try {
        const payload = parseJwt(response.credential);
        if (!payload) {
          showNotification('Could not parse Google token', 'error');
          return;
        }

        const email = payload.email;
        const name = payload.name || payload.given_name || '';
        
        if (!email) {
          showNotification('Google account email not available', 'warning');
          return;
        }

        const users = getUsers();
        let user = users.find(u => u.email === email);
        
        if (!user) {
          user = {
            id: 'u' + Date.now(),
            name: name || email.split('@')[0],
            email: email,
            password: '',
            role: 'user',
            provider: 'google',
            createdAt: new Date().toISOString()
          };
          users.push(user);
          saveUsers(users);
        }

        setCurrentUser(user);
        showNotification(`‚úÖ Welcome, ${user.name}!`, 'success');
        setTimeout(() => location.href = '/pages/user-dashboard.html', 800);
      } catch (error) {
        console.error('Google sign-in error:', error);
        showNotification('Google sign-in error', 'error');
      }
    }

    // ===== JWT PARSER =====
    function parseJwt(token) {
      try {
        const payload = token.split('.')[1];
        const json = atob(payload.replace(/-/g, '+').replace(/_/g, '/'));
        return JSON.parse(decodeURIComponent(escape(json)));
      } catch (e) {
        console.error('JWT parse error:', e);
        return null;
      }
    }

    // ===== INITIALIZATION =====
    document.addEventListener('DOMContentLoaded', function() {
      bootstrap();

      // Bind user login form
      const loginForm = document.getElementById('loginForm');
      if (loginForm) {
        loginForm.addEventListener('submit', userLogin);
      }

      // Initialize Google Sign-In
      if (typeof google !== 'undefined' && google.accounts && google.accounts.id) {
        const CLIENT_ID = 'YOUR_GOOGLE_CLIENT_ID.apps.googleusercontent.com';
        google.accounts.id.initialize({
          client_id: CLIENT_ID,
          callback: handleGoogleCredential
        });

        if (document.getElementById('googleSignInBtn')) {
          google.accounts.id.renderButton(
            document.getElementById('googleSignInBtn'),
            { theme: 'outline', size: 'large', width: 240 }
          );
        }
      }

      console.log('‚úÖ Login page ready');
      console.log('üë§ User login tab active by default');
      console.log('üîê Admin login available via tab switch');
    });
  </script></body>
</html>
"@