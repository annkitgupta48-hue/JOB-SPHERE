<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Categories - Job Sphere</title>
    <link rel="stylesheet" href="../style.css">

    <style>

        /* üåà Modern Background */
        body {
            background: linear-gradient(135deg, #e3f2fd, #fce4ec);
            font-family: "Poppins", sans-serif;
            color: #222;
        }

        /* üåü Header */
        .header {
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            padding: 14px 0;
            box-shadow: 0 3px 10px rgba(0, 0, 0, .2);
        }
        .header .brand strong { color: white; }
        .header .logo { background: white; color: #2575fc; }

        /* üé® Title */
        h2 { text-align: center; margin-top: 28px; color: #143; font-weight: 800; }

        /* üåê Category Filter Chips */
        .category-chip { display: inline-block; padding: 10px 18px; background: white; border-radius: 12px; margin: 8px; font-weight: 600; cursor: pointer; box-shadow: 0 6px 18px rgba(0,0,0,0.08); border: 2px solid #fff; transition: 0.18s ease; }
        .category-chip:hover { transform: translateY(-4px); background: linear-gradient(45deg, #42a5f5, #478ed1); color: white; border-color: transparent; }
        .category-chip:focus { outline: 3px solid rgba(66,165,245,0.25); }
        .category-chip-active { background: linear-gradient(45deg, #8e24aa, #6a1b9a); color: white; border: none; transform: translateY(-4px); }

        /* Filters container */
        .filter-row { margin-top: 20px; text-align: center; padding: 20px; }

        /* ===== Vertical Columns (6+) ===== */
        .columns-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 18px; max-width: 1200px; margin: 26px auto; padding: 0 12px; }
        .col { background: white; border-radius: 12px; padding: 14px; box-shadow: 0 8px 26px rgba(16,24,40,0.06); min-height: 220px; display:flex; flex-direction:column; }
        .col h3 { margin: 0 0 10px 0; font-size: 1rem; color: #2e7d32; font-weight: 700; }
        .category-list { list-style: none; padding: 0; margin: 0; display:flex; flex-direction: column; gap: 8px; }
        .category-list a { display: inline-block; padding: 10px 12px; border-radius: 9px; text-decoration: none; color: #143; background: #fbfffd; font-weight:600; transition: all 0.18s ease; border: 1px solid rgba(34,34,34,0.04); }
        .category-list a:hover { transform: translateX(6px); box-shadow: 0 10px 30px rgba(46,125,50,0.06); background: linear-gradient(90deg,#f0fff4,#e8f5e9); color:#1b5e20; }
        .category-list a:focus { outline: 3px solid rgba(46,125,50,0.12); }

        /* small screens: 2 columns */
        @media (max-width: 1100px) { .columns-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 700px) { .columns-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 420px) { .columns-grid { grid-template-columns: 1fr; } }

        /* Footer */
        .footer { background: linear-gradient(90deg, #6a11cb, #2575fc); color: white; text-align: center; padding: 12px; margin-top: 40px; }
    </style>
</head>


<body>   
     


    <!-- üåà HEADER -->
    <header class="header">
        <div class="container wrap">
            <a class="brand" href="/index.html">
                <div class="logo">JS</div>
                <div><strong>Job Sphere</strong></div>
            </a>
        </div>
    </header> 



    <!-- MAIN CONTENT -->
    <main class="container">
        <h2>Explore Job Categories</h2>
        <p style="text-align:center; margin-top:8px; color:#555;">
            Choose a category to view all job listings inside it
        </p>

        <div id="categoryFilters" class="filter-row">
            <!-- Dynamically filled through JS below -->
        </div>

        <!-- New: Job Filters and Results -->
        <section id="jobFilterSection" style="max-width:1200px;margin:16px auto;padding:12px;">
            <div style="background:rgba(255,255,255,0.9);padding:14px;border-radius:12px;box-shadow:0 8px 26px rgba(16,24,40,0.06);">
                <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:center;justify-content:center;">
                    <select id="filterCategory" style="padding:10px;border-radius:8px;border:1px solid #ddd;min-width:180px;">
                        <option value="">All Categories</option>
                    </select>
                    <select id="filterLocation" style="padding:10px;border-radius:8px;border:1px solid #ddd;min-width:180px;">
                        <option value="">All Locations</option>
                    </select>
                    <select id="filterType" style="padding:10px;border-radius:8px;border:1px solid #ddd;min-width:150px;">
                        <option value="">All Types</option>
                        <option value="Full-time">Full-time</option>
                        <option value="Part-time">Part-time</option>
                        <option value="Contract">Contract</option>
                        <option value="Internship">Internship</option>
                        <option value="Remote">Remote</option>
                    </select>
                    <input id="filterSearch" placeholder="Search title, company or description" style="padding:10px;border-radius:8px;border:1px solid #ddd;min-width:280px;" />
                    <button id="applyFiltersBtn" class="btn" style="padding:10px 14px;">Filter</button>
                    <button id="clearFiltersBtn" class="btn" style="background:#f0f0f0;color:#333;padding:10px 14px;">Clear</button>
                </div>
            </div>

            <div id="filterResults" style="margin-top:12px;"></div>
        </section>

        <!-- 6 Vertical Columns: each column lists related categories as links -->
        <section id="categoryColumns" style="margin-top:26px;">
            <div class="columns-grid" id="columnsGrid">
                <!-- Columns injected by JS -->
            </div>
        </section>
        
        <!-- Admin panel: edit apply links (hidden unless admin) -->
        <section id="linkAdmin" class="admin-panel" style="display:none; max-width:1000px; margin:20px auto;">
            <h3>Admin ‚Äî Edit Job Apply Links</h3>
            <p class="small">Edit the application URL for any job. Click <strong>Open</strong> to preview, then <strong>Save</strong> to persist.</p>
            <div id="linkAdminList" style="margin-top:12px;"></div>
            <div style="margin-top:12px;">
                <button id="saveAllLinksBtn" class="btn" onclick="saveAllLinks()">Save All</button>
            </div>
        </section>


    </main>

    <!-- FOOTER -->
    <footer class="footer">
        ¬© Job Spare
    </footer>

    <script src="/db.js"></script>
    <script src="../app.js"></script>

    <script>
        // Job filtering logic: populates selects and renders filtered jobs
        function populateFilterOptions() {
            const cats = getCategories();
            const jobs = getJobs();
            const catSelect = document.getElementById('filterCategory');
            const locSelect = document.getElementById('filterLocation');

            // populate categories
            if (catSelect) {
                cats.forEach(c => {
                    const opt = document.createElement('option'); opt.value = c; opt.textContent = c; catSelect.appendChild(opt);
                });
            }

            // populate locations (unique)
            const locations = Array.from(new Set(jobs.map(j => j.location || '').filter(x=>x)));
            if (locSelect) {
                locations.forEach(l => { const o = document.createElement('option'); o.value = l; o.textContent = l; locSelect.appendChild(o); });
            }
        }

        function renderFilterResults() {
            const container = document.getElementById('filterResults');
            if (!container) return;
            const cat = (document.getElementById('filterCategory') || {}).value || '';
            const loc = (document.getElementById('filterLocation') || {}).value || '';
            const type = (document.getElementById('filterType') || {}).value || '';
            const search = ((document.getElementById('filterSearch') || {}).value || '').toLowerCase().trim();

            let jobs = getJobs();
            // only approved jobs by default
            jobs = jobs.filter(j => j.status === 'approved');
            if (cat) jobs = jobs.filter(j => (j.category||'') === cat);
            if (loc) jobs = jobs.filter(j => (j.location||'') === loc);
            if (type) jobs = jobs.filter(j => (j.type||'').toLowerCase() === type.toLowerCase());
            if (search) jobs = jobs.filter(j => (j.title||'').toLowerCase().includes(search) || (j.company||'').toLowerCase().includes(search) || (j.description||'').toLowerCase().includes(search));

            if (jobs.length === 0) {
                container.innerHTML = '<p class="small" style="text-align:center;color:#666;padding:18px;background:white;border-radius:8px;">No jobs match your filters.</p>';
                return;
            }

            const html = jobs.map(j => `
                <div class="col" style="margin-bottom:12px;display:flex;flex-direction:row;gap:12px;align-items:flex-start;">
                  <div style="flex:1;">
                    <h3 style="margin:0">${escapeHtml(j.title)}</h3>
                    <div style="color:#666;margin:6px 0">${escapeHtml(j.company)} ‚Ä¢ ${escapeHtml(j.location||'Remote')} ‚Ä¢ <span style="background:#e8f5e9;color:#2e7d32;padding:4px 8px;border-radius:6px">${escapeHtml(j.category||'')}</span></div>
                    <p style="color:#444;margin:0">${escapeHtml((j.description||'').slice(0,220))}${(j.description||'').length>220?'...':''}</p>
                  </div>
                  <div style="flex:0 0 160px;display:flex;flex-direction:column;gap:8px;align-items:stretch;">
                    <a href="/pages/job-details.html?id=${encodeURIComponent(j.id)}" class="btn" style="background:#f0f0f0;color:#333;text-align:center;padding:8px;border-radius:8px;text-decoration:none;">View</a>
                    <a href="${escapeAttr(j.applyLink||'#')}" target="_blank" class="btn" style="background:#2e7d32;color:#fff;text-align:center;padding:8px;border-radius:8px;text-decoration:none;">Apply</a>
                    <div style="font-size:0.85rem;color:#999;text-align:center;padding:6px;background:#fff;border-radius:6px;border:1px solid #eee;">Type: ${escapeHtml(j.type||'N/A')}</div>
                  </div>
                </div>
            `).join('');

            container.innerHTML = `<div style="display:flex;flex-direction:column;gap:12px;">${html}</div>`;
        }

        document.addEventListener('DOMContentLoaded', ()=>{
            populateFilterOptions();
            // hook up buttons
            const applyBtn = document.getElementById('applyFiltersBtn');
            const clearBtn = document.getElementById('clearFiltersBtn');
            if (applyBtn) applyBtn.addEventListener('click', renderFilterResults);
            if (clearBtn) clearBtn.addEventListener('click', ()=>{
                (document.getElementById('filterCategory')||{}).value = '';
                (document.getElementById('filterLocation')||{}).value = '';
                (document.getElementById('filterType')||{}).value = '';
                (document.getElementById('filterSearch')||{}).value = '';
                renderFilterResults();
            });
            // also allow filtering via Enter key in search
            const searchEl = document.getElementById('filterSearch');
            if (searchEl) searchEl.addEventListener('keypress', (e)=>{ if(e.key==='Enter') renderFilterResults(); });
            // initial render: show top jobs
            renderFilterResults();
        });

        // Build columns and interactive chips, keep keyboard focus accessible
        (function (){
            // Default columns (6) with related category types
            const columnsData = [
                [ 'IT & Software', 'Web Development', 'DevOps', 'Data Science' ],
                [ 'Marketing & Sales', 'Content Writing', 'SEO', 'Social Media' ],
                [ 'Finance', 'Accounting', 'Banking', 'FinTech' ],
                [ 'Government', 'Public Sector', 'Civil Services', 'Defence' ],
                [ 'Private', 'Operations', 'HR', 'Management' ],
                [ 'Internships', 'Student Jobs', 'Part-time', 'Fresher Roles' ]
            ];

            // If DBModule provides categories, merge them into the first column (avoid duplicates)
            try {
                const storedCats = (typeof DBModule !== 'undefined' && DBModule.getCategories) ? DBModule.getCategories() : [];
                if (Array.isArray(storedCats) && storedCats.length) {
                    storedCats.forEach(c => {
                        if (!columnsData[0].includes(c)) columnsData[0].push(c);
                    });
                }
            } catch (e) { /* ignore */ }

            const columnsGrid = document.getElementById('columnsGrid');
            const filterRow = document.getElementById('categoryFilters');

            // Utility: build a safe link to jobs page filtered by category
            function jobsLinkFor(category){
                return '/pages/jobs.html?category=' + encodeURIComponent(category);
            }

            // Render columns
            columnsData.forEach((colArr, idx) => {
                const col = document.createElement('div'); col.className = 'col';
                const heading = document.createElement('h3'); heading.textContent = colArr[0] + (idx===0 ? ' & More' : '');
                col.appendChild(heading);

                const ul = document.createElement('ul'); ul.className = 'category-list';
                colArr.forEach(cat => {
                    const a = document.createElement('a');
                    a.href = jobsLinkFor(cat);
                    a.textContent = cat;
                    a.setAttribute('role','link');
                    a.setAttribute('tabindex','0');
                    // keyboard activation
                    a.addEventListener('keypress', (ev)=>{ if(ev.key==='Enter') window.location.href = a.href; });
                    ul.appendChild((function(){ const li = document.createElement('li'); li.appendChild(a); return li; })());
                });
                col.appendChild(ul);
                columnsGrid.appendChild(col);
            });

            // Collect unique categories to render as filter chips
            const allCats = Array.from(new Set(columnsData.flat()));
            allCats.forEach(cat => {
                const btn = document.createElement('button');
                btn.className = 'category-chip';
                btn.type = 'button';
                btn.textContent = cat;
                btn.addEventListener('click', ()=>{
                    document.querySelectorAll('.category-chip').forEach(c=>c.classList.remove('category-chip-active'));
                    btn.classList.add('category-chip-active');
                    // navigate to jobs page for selected category
                    window.location.href = jobsLinkFor(cat);
                });
                btn.addEventListener('keypress', (ev)=>{ if(ev.key==='Enter') btn.click(); });
                filterRow.appendChild(btn);
            });

            // Accessibility: allow focusing category links with keyboard
            columnsGrid.querySelectorAll('a').forEach(a=>{
                a.addEventListener('focus', ()=> a.style.boxShadow = '0 12px 30px rgba(46,125,50,0.08)');
                a.addEventListener('blur', ()=> a.style.boxShadow = '');
            });
        })();
    </script>

</body>

</html>
